// COMMANDES POUR ARTISAN TINKER - COPIEZ-COLLEZ UNE PAR UNE

// 1. Charger les utilisateurs
$mohamed = App\Models\User::where('name', 'like', '%Mohammed%')->first();
$fatima = App\Models\User::where('name', 'like', '%Fatima%')->first();
$ahmed = App\Models\User::where('name', 'like', '%Ahmed%')->first();

// 2. VÃ©rifier qu'ils existent
echo "Mohamed: " . ($mohamed ? $mohamed->name . " (ID: {$mohamed->id})" : "NON TROUVÃ‰") . "\n";
echo "Fatima: " . ($fatima ? $fatima->name . " (ID: {$fatima->id})" : "NON TROUVÃ‰") . "\n";
echo "Ahmed: " . ($ahmed ? $ahmed->name . " (ID: {$ahmed->id})" : "NON TROUVÃ‰") . "\n";

// 3. VÃ©rifier les relations de Mohamed
echo "\nðŸ”— Relations de Mohamed:\n";
$mohamedRelations = App\Models\FamilyRelationship::where('user_id', $mohamed->id)->orWhere('related_user_id', $mohamed->id)->with(['user', 'relatedUser', 'relationshipType'])->get();
foreach ($mohamedRelations as $rel) {
    echo "   {$rel->user->name} â†’ {$rel->relatedUser->name} : {$rel->relationshipType->name}\n";
}

// 4. VÃ©rifier les relations d'Ahmed
echo "\nðŸ”— Relations d'Ahmed:\n";
$ahmedRelations = App\Models\FamilyRelationship::where('user_id', $ahmed->id)->orWhere('related_user_id', $ahmed->id)->with(['user', 'relatedUser', 'relationshipType'])->get();
foreach ($ahmedRelations as $rel) {
    echo "   {$rel->user->name} â†’ {$rel->relatedUser->name} : {$rel->relationshipType->name}\n";
}

// 5. Supprimer les anciennes suggestions de Mohamed
App\Models\Suggestion::where('user_id', $mohamed->id)->delete();

// 6. GÃ©nÃ©rer les nouvelles suggestions avec debug
echo "\nðŸ§ª GÃ‰NÃ‰RATION DES SUGGESTIONS POUR MOHAMED:\n";
$suggestionService = app(App\Services\SuggestionService::class);
$suggestions = $suggestionService->generateSuggestions($mohamed);

// 7. Analyser les rÃ©sultats
echo "\nðŸ’¡ Suggestions gÃ©nÃ©rÃ©es:\n";
foreach ($suggestions as $suggestion) {
    echo "   - {$suggestion->suggestedUser->name} : {$suggestion->suggested_relation_code}\n";
    echo "     Raison: {$suggestion->reason}\n";
    if ($suggestion->suggested_user_id === $fatima->id) {
        echo "     ðŸŽ¯ FATIMA: {$suggestion->suggested_relation_code} (attendu: mother)\n";
        if ($suggestion->suggested_relation_code === 'mother') {
            echo "     âœ… CORRECT!\n";
        } else {
            echo "     âŒ INCORRECT!\n";
        }
    }
}

// 8. Test inverse - Suggestions pour Fatima
echo "\nðŸ”„ TEST INVERSE - Suggestions pour Fatima:\n";
App\Models\Suggestion::where('user_id', $fatima->id)->delete();
$fatimasuggestions = $suggestionService->generateSuggestions($fatima);
foreach ($fatimasuggestions as $suggestion) {
    if ($suggestion->suggested_user_id === $mohamed->id) {
        echo "   ðŸŽ¯ FATIMA â†’ MOHAMED: {$suggestion->suggested_relation_code} (attendu: son)\n";
    }
}
